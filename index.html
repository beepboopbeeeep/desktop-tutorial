<input id="domain" placeholder="دامنه‌ای مثل example.com" />
<button onclick="testIP()">تست آی‌پی نود کلادفلر</button>
<pre id="output">در انتظار...</pre>

<script>
  async function testIP() {
    const dom = document.getElementById("domain").value.trim();
    const proxyURL = `https://cfipscanner.nedorir.workers.dev/?domain=${dom}`;
    document.getElementById("output").textContent = "🔍 در حال دریافت آی‌پی...";

    try {
      const res = await fetch(proxyURL);
      const data = await res.json();
      const ips = data.Answer?.filter(r => r.type === 1).map(r => r.data) || [];

      if (!ips.length) {
        document.getElementById("output").textContent = "⛔ آی‌پی کلادفلری یافت نشد.";
        return;
      }

      let result = `🌐 دامنه: ${dom}\n`;
      for (const ip of ips) {
        const start = performance.now();
        try {
          await fetch(`https://${ip}/cdn-cgi/trace`, { mode: "no-cors" });
          const latency = Math.round(performance.now() - start);
          result += `✅ آی‌پی ${ip} - latency تقریبی: ${latency} ms\n`;
        } catch {
          result += `❌ آی‌پی ${ip} - پاسخ نداد\n`;
        }
      }

      document.getElementById("output").textContent = result;
    } catch (err) {
      document.getElementById("output").textContent = "❌ خطا در دریافت یا تست آی‌پی.";
    }
  }
</script>
